location /api/downloads/stream {
    proxy_pass $forward_scheme://$server:$port;

    proxy_buffering off;
    proxy_request_buffering off;
    proxy_cache off;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Upgrade $http_upgrade;

    proxy_set_header Cache-Control "no-cache, no-store, must-revalidate";
    proxy_set_header Pragma "no-cache";
    proxy_set_header Expires "0";

    add_header X-Accel-Buffering "no";

    # Long timeout for streaming
    proxy_read_timeout 24h;
    proxy_connect_timeout 30s;
    proxy_send_timeout 30s;

    # No compression
    gzip off;
}

# Regular API endpoints
location /api/ {
    proxy_pass $forward_scheme://$server:$port;
    proxy_buffering off;
    proxy_request_buffering off;
}
